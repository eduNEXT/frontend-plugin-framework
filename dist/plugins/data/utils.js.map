{"version":3,"file":"utils.js","names":["_react","_interopRequireDefault","require","_frontendPlatform","_logging","_constants","_excluded","obj","__esModule","default","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","key","value","_toPropertyKey","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","_objectWithoutProperties","source","excluded","target","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","prototype","propertyIsEnumerable","hasOwnProperty","validateRequirements","requiredTypes","widgetConfig","every","field","validatePlugin","pluginConfig","op","config","logError","PLUGIN_OPERATIONS","Insert","widget","requiredPluginTypes","base","type","toLowerCase","widgetId","id","exports","organizePlugins","defaultContents","plugins","newContents","change","Hide","find","w","hidden","Modify","widgetIdx","findIndex","fn","Wrap","newWidget","wrappers","wrapper","sort","a","b","priority","localeCompare","wrapComponent","renderComponent","reduce","component","idx","React","createElement","getConfigSlots","getConfig","pluginSlots","_default"],"sources":["../../../src/plugins/data/utils.jsx"],"sourcesContent":["import React from 'react';\nimport { getConfig } from '@edx/frontend-platform';\nimport { logError } from '@edx/frontend-platform/logging';\nimport { PLUGIN_OPERATIONS, requiredPluginTypes } from './constants';\n\n/**\n * Called by validatePlugin to compare plugin config to the required data and data types\n * @returns {Boolean} - returns true if all types are correct and present according to the plugin operation\n */\nconst validateRequirements = (requiredTypes, widgetConfig) => (Object.keys(requiredTypes).every(\n  // eslint-disable-next-line valid-typeof\n  (field) => (widgetConfig[field] && (typeof widgetConfig[field] === requiredTypes[field])),\n));\n\n/**\n * Called by organizePlugins to validate plugin configurations\n * @returns {Boolean} - boolean if all types are correct and present, else throws an error\n */\nexport const validatePlugin = (pluginConfig) => {\n  let requiredTypes = {};\n  // eslint-disable-next-line prefer-const\n  let { op, ...config } = pluginConfig;\n  if (!op) { logError('There is a config with an invalid PLUGIN_OPERATION. Check to make sure it is configured correctly.'); }\n\n  if (op === PLUGIN_OPERATIONS.Insert) {\n    config = config.widget;\n    if (!config) { logError('insert operation config is missing widget object'); }\n\n    requiredTypes = {\n      ...requiredPluginTypes[op].base,\n      ...requiredPluginTypes[op][config.type?.toLowerCase()],\n    };\n  } else {\n    requiredTypes = requiredPluginTypes[op];\n  }\n\n  if (!validateRequirements(requiredTypes, config)) {\n    logError(`the ${op} operation config is invalid for widget id: ${config.widgetId || config.id || 'MISSING ID'}`);\n  }\n  return true;\n};\n\n/**\n * Called by PluginSlot to prepare the plugin changes for the given slot\n *\n * @param {Array} defaultContents - The default widgets where the plugin slot exists.\n * @param {Array} plugins - All of the changes assigned to the specific plugin slot\n * @returns {Array} - A sorted list of widgets with any additional properties needed to render them in the plugin slot\n */\nexport const organizePlugins = (defaultContents, plugins) => {\n  const newContents = [...defaultContents];\n\n  plugins.forEach(change => {\n    validatePlugin(change);\n    if (change.op === PLUGIN_OPERATIONS.Insert) {\n      newContents.push(change.widget);\n    } else if (change.op === PLUGIN_OPERATIONS.Hide) {\n      const widget = newContents.find((w) => w.id === change.widgetId);\n      if (widget) { widget.hidden = true; }\n    } else if (change.op === PLUGIN_OPERATIONS.Modify) {\n      const widgetIdx = newContents.findIndex((w) => w.id === change.widgetId);\n      if (widgetIdx >= 0) {\n        const widget = { ...newContents[widgetIdx] };\n        newContents[widgetIdx] = change.fn(widget);\n      }\n    } else if (change.op === PLUGIN_OPERATIONS.Wrap) {\n      const widgetIdx = newContents.findIndex((w) => w.id === change.widgetId);\n      if (widgetIdx >= 0) {\n        const newWidget = { wrappers: [], ...newContents[widgetIdx] };\n        newWidget.wrappers.push(change.wrapper);\n        newContents[widgetIdx] = newWidget;\n      }\n    }\n  });\n\n  newContents.sort((a, b) => (a.priority - b.priority) * 10_000 + a.id.localeCompare(b.id));\n  return newContents;\n};\n\n/** Wraps the plugin component with number of wrappers provided.\n *\n * @param {Function} renderComponent - Function that returns JSX (i.e. React Component)\n * @param {Array} wrappers - Array of components that each use a \"component\" prop to render the wrapped contents\n * @returns {React.ReactElement} - The plugin component wrapped by any number of wrappers provided.\n*/\nexport const wrapComponent = (renderComponent, wrappers) => wrappers.reduce(\n  // Disabled lint because currently we don't have a unique identifier for this\n  // The \"component\" and \"wrapper\" are both functions\n  // eslint-disable-next-line react/no-array-index-key\n  (component, wrapper, idx) => React.createElement(wrapper, { component, idx }),\n  renderComponent(),\n);\n\n/**\n * Called by usePluginSlot to retrieve the most up-to-date Config Document*\n * @returns {Object} - The pluginSlots object in Config Document\n */\nexport const getConfigSlots = () => getConfig()?.pluginSlots;\n\nexport default {\n  getConfigSlots,\n  organizePlugins,\n  validatePlugin,\n  wrapComponent,\n};\n"],"mappings":"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","ignoreList":[]}