{"version":3,"file":"hooks.js","names":["_react","require","_utils","_constants","usePluginSlot","id","configSlots","getConfigSlots","keepDefault","plugins","useMessageEvent","srcWindow","type","callback","useLayoutEffect","listener","event","source","data","payload","global","addEventListener","removeEventListener","useHostEvent","parent","usePluginEvent","element","contentWindow","dispatchMessageEvent","targetWindow","message","targetOrigin","postMessage","dispatchPluginEvent","dispatchHostEvent","document","referrer","dispatchReadyEvent","PLUGIN_READY","dispatchMountedEvent","PLUGIN_MOUNTED","dispatchUnmountedEvent","PLUGIN_UNMOUNTED","useElementSize","observerRef","useRef","dimensions","setDimensions","useState","width","height","offset","setOffset","x","y","setElement","measuredRef","useCallback","_element","useEffect","current","ResizeObserver","clientWidth","clientHeight","offsetLeft","offsetTop","observe","useMemo"],"sources":["../../../src/plugins/data/hooks.js"],"sourcesContent":["/**\n * Hooks file for functions that handle the communication between a Plugin and its Host\n */\n\nimport {\n  useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState,\n} from 'react';\nimport { getConfigSlots } from './utils';\nimport { PLUGIN_MOUNTED, PLUGIN_READY, PLUGIN_UNMOUNTED } from './constants';\n\n/**\n * Called by PluginSlot to extract a list of plugins from the JS configuration\n *\n * @param {String} id - Name of PluginSlot\n * @returns {Object} - JS configuration for the PluginSlot\n */\nexport function usePluginSlot(id) {\n  const configSlots = getConfigSlots()?.[id];\n  if (configSlots) {\n    return configSlots;\n  }\n  return { keepDefault: true, plugins: [] };\n}\n\n/* Listening for events */\n\n/**\n * Dynamically add an event listener to the provided source window.\n * The source window can be the global parent (ie. the \"window\" object in the browser)\n * or it can be the content window of an individual element (ie. iFrame plugin container)\n *\n * @param {Object} srcWindow - Window object that the event originates from\n * @param {String} type - Event name (eg. PLUGIN_RESIZE)\n * @param {Function} callback - Called when the event is triggered\n */\nexport function useMessageEvent(srcWindow, type, callback) {\n  // useLayoutEffect is called before the browser repaints the screen\n  useLayoutEffect(() => {\n    // Create a listener callback function\n    const listener = (event) => {\n      // Filter messages to those from our source window.\n      // NOTE: the \"srcWindow\" is determined by the below useHostEvent and usePluginEvent functions\n      if (event.source === srcWindow) {\n        // Fire callback if the type from the listened event matches the type from the message event\n        if (event.data.type === type) {\n          callback({ type, payload: event.data.payload });\n        }\n      }\n    };\n    // Add the listener to the global object if the srcWindow is not null\n    if (srcWindow !== null) {\n      global.addEventListener('message', listener);\n    }\n    // useEffect cleanup\n    return () => {\n      global.removeEventListener('message', listener);\n    };\n  }, [srcWindow, type, callback]);\n}\n\n/**\n * Called by the Plugin component to use events that were listened to (ie. PLUGIN_RESIZE)\n *\n * @param {String} type - Event name (eg. PLUGIN_RESIZE)\n * @param {Function} callback - Called when the event is triggered\n */\nexport function useHostEvent(type, callback) {\n  useMessageEvent(global.parent, type, callback);\n}\n\n/**\n * Used to listen for events from a wrapped Plugin element (eg. PluginContainerIframe)\n *\n * @param {Object} element - Plugin element (eg. <iframe>)\n * @param {String} type - Event type (eg. PLUGIN_RESIZE)\n * @param {Function} callback - Function to call when the event is triggered\n */\nexport function usePluginEvent(element, type, callback) {\n  const contentWindow = element ? element.contentWindow : null;\n  useMessageEvent(contentWindow, type, callback);\n}\n\n/** Dispatching events */\n\n/**\n * Base dispatch function called by dispatchHostEvent and dispatchPluginEvent.\n * Uses the `postMessage` method to enable cross-origin communication between Window objects\n *\n * @param {Object} targetWindow - Window that the message event is being dispatched to\n * @param {Object} message - Data object for the message\n * @param {String} targetOrigin - URL for the window that the message event is being dispatched from\n */\nexport function dispatchMessageEvent(targetWindow, message, targetOrigin) {\n  /** Checking targetOrigin falsiness here since '', null or undefined would all be\n   * reasons not to try to post a message to the origin.\n   */\n  if (targetOrigin) {\n    targetWindow.postMessage(message, targetOrigin);\n  }\n}\n\n/**\n * Used to dispatch events for a Plugin\n *\n * @param {Object} element - Plugin element (eg. <iframe>)\n * @param {Object} message - Data object for the message\n * @param {String} targetOrigin - URL for the window that the message event is being dispatched from\n */\nexport function dispatchPluginEvent(element, message, targetOrigin) {\n  dispatchMessageEvent(element.contentWindow, message, targetOrigin);\n}\n\n/**\n * Used to dispatch events for the Host\n *\n * @param {Object} message - Data object for the message\n */\nexport function dispatchHostEvent(message) {\n  dispatchMessageEvent(global.parent, message, global.document.referrer);\n}\n\n// Called inside Plugin when 'ready' prop is true\nexport function dispatchReadyEvent() {\n  dispatchHostEvent({ type: PLUGIN_READY });\n}\n\n// Below mounted events are called in a useEffect inside Plugin with [] dependencies — https://react.dev/learn/synchronizing-with-effects\nexport function dispatchMountedEvent() {\n  dispatchHostEvent({ type: PLUGIN_MOUNTED });\n}\n\nexport function dispatchUnmountedEvent() {\n  dispatchHostEvent({ type: PLUGIN_UNMOUNTED });\n}\n\n/**\n * Used to determine the size of an element as it is being resized in the browser.\n * ResizeObserver (https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver) is used to maintain a reference to the element's content/border box.\n *\n * @returns Memoized value that contains a reference to the Plugin element (eg. iframe)\n */\nexport function useElementSize() {\n  // Holds a reference to the ResizeObserver\n  const observerRef = useRef();\n\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\n  const [offset, setOffset] = useState({ x: 0, y: 0 });\n\n  // Reference to the Plugin element (eg. <iframe>)\n  const [element, setElement] = useState(null);\n\n  // Sets a reference to the Plugin element when passed to the Plugin element as a \"ref\" attribute (eg. <iframe>)\n  const measuredRef = useCallback(_element => {\n    setElement(_element);\n  }, []);\n\n  useEffect(() => {\n    // Create a new ResizeObserver\n    observerRef.current = new ResizeObserver(() => {\n      if (element) {\n        // Set dimensions and any offset\n        setDimensions({\n          width: element.clientWidth,\n          height: element.clientHeight,\n        });\n        setOffset({\n          x: element.offsetLeft,\n          y: element.offsetTop,\n        });\n      }\n    });\n    if (element) {\n      // Tell the ResizeObserver to start watching the element — this enables the hook to detect resizing\n      observerRef.current.observe(element);\n    }\n  }, [element]);\n\n  return useMemo(\n    () => ([measuredRef, element, dimensions.width, dimensions.height, offset.x, offset.y]),\n    [measuredRef, element, dimensions, offset],\n  );\n}\n"],"mappings":"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","ignoreList":[]}